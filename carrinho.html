<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/style.css">
    <title> Meu Carrinho</title>
    <!-- Biblioteca de icones -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <!-- Link para a biblioteca Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <!-- Link para a biblioteca de ICONS-->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

</head>

<body>
    <header>
        <nav class="navbar">
            <button class="menu-toggle" id="menuToggle">
                <ion-icon name="menu"></ion-icon>
            </button>
            <img src="assets/img/logo.png" alt="Logo" class="logo">
            <div class="menu-icons">
                <a id="searchIcon"><ion-icon name="search"></ion-icon></a>
                <a href="cadastrologin.html"><ion-icon name="person"></ion-icon></a>
            </div>
            <div class="dropdown-menu" id="dropdownMenu">
                <ul>
                    <div class="header-drop">
                        <img src="assets/img/exemplo-perfil.webp" alt="" class="img-perfil">
                    </div>
                    <span id="span-nome">Nome sobrenome</span>
                    <li class="menu-list"><a href="index.html"><i class="fa-solid fa-house"></i>Inicio</a></li>
                    <li class="menu-list"><a href="questionario.html"><ion-icon
                                name="newspaper-sharp"></ion-icon>Questionario</a></li>
                    <li class="menu-list"><a href="assinaturas.html"><ion-icon name="star-sharp"></ion-icon>Minhas
                            assinaturas</a></li>
                    <li class="menu-list"><a href="diario.html"><ion-icon name="happy-sharp"></ion-icon>Meu humor</a>
                    </li>
                    <li class="menu-list"><a href="indicacoes.html"><ion-icon name="flame"></ion-icon>Indicações</a>
                    </li>
                    <li class="menu-list"><a href="configuracoes.html"><ion-icon name="cog"></ion-icon>Configurações</a>
                    </li>
                    <li class="menu-list"><a href="termos.html"><ion-icon name="lock-closed"></ion-icon>Termos de
                            privacidade</a></li>
                    <li class="menu-list"><a href="#"><ion-icon name="exit-outline"></ion-icon>Sair</a></li>
                </ul>
            </div>
        </nav>
        <div class="search-container" id="searchContainer">
            <div class="search-input" id="searchInput">
                <input type="text" id="searchField" placeholder="Buscar...">
                <ion-icon class="search-icon" name="search-outline"></ion-icon>
            </div>
        </div>
    </header>

    <main class="conteudo-questionario">
        <h2>Seu kit está pronto!</h2>

        <hr class="separador-carrinho">

        <p>Tratamento escolhido: <span id="tratamentoEscolhido"></span></p>

        <div class="product-card-container">


            <div id="container-button-prod">
                <span class="aviso-carrinho">Você pode adicionar até 5 produtos</span>
                <button id="addProduto" class="btnQuestionario">Adicionar</button>

            </div>

            <hr class="separador-carrinho">

            <div class="tipoAssinatura" method="post" action="#">


                <h3>Forma de Assinatura</h3>

                <label class="cateAssinatura">
                    <input type="radio" required name="plano"> Mensal - R$100,00 </label>

                <label class="cateAssinatura">
                    <input type="radio" required name="plano" checked> Trimestral - R$250,00 (Recomendado)
                </label>


            </div>

            <hr class="separador-carrinho">

            <div class="infoPessoais">
                <h3>Dados Pessoais para entrega</h3>
                <a>
                    <span class="cpf-carrinho">
                        <p>Informe CPF</p>
                        <p>___.___.___-__</p>
                    </span>
                    <i class='bx bx-chevron-right'></i>
                </a>
                <hr class="card-line">
                <a>
                    <span class="cpf-carrinho">
                        <p>Informe CEP</p>
                        <p>___.___.___-__</p>
                    </span>
                    <i class='bx bx-chevron-right'></i>
                </a>
            </div>

            <hr class="separador-carrinho">

            <div class="tipoPagamento">
                <h3>Forma de Pagamento</h3>
                <a>
                    <p>Selecione a forma de pagamento </p>
                    <i class='bx bx-chevron-right'></i>
                </a>
            </div>

            <button class="btnQuestionario">Assinar</button>

        </div>

    </main>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let tratamento = localStorage.getItem("tratamento");
            console.log(tratamento);
            document.getElementById("tratamentoEscolhido").textContent = tratamento;
    
            // Adicionar três cards ao carregar a página
            for (let i = 1; i <= 3; i++) {
                createNewCard(`card${i}`);
            }
    
            // Atualiza a contagem de cards ao carregar a página
            updateCardCount();
        });
    
        let lastActiveImageIndex = 0;
    
        function createNewCard(cardId) {
            const tratamento = localStorage.getItem("tratamento");
            const imagens = getImagensTratamento(tratamento);
    
            // Determine o índice da próxima imagem principal a ser usada
            const mainImageIndex = lastActiveImageIndex % imagens.length;
            lastActiveImageIndex++;
    
            const cardTemplate = document.createElement('div');
            cardTemplate.classList.add('product-card');
            cardTemplate.id = cardId;
            cardTemplate.innerHTML = `
                <div class="logo-card">
                    <img src="assets/img/logo.png" alt="logo">
                    <i class='bx bxs-trash-alt'></i>
                </div>
                <div class="main-images">
                    <img id="main-img1-${cardId}" class="main-img ${mainImageIndex === 0 ? 'active' : ''}" src="${imagens[0]}" alt="img1">
                    <img id="main-img2-${cardId}" class="main-img ${mainImageIndex === 1 ? 'active' : ''}" src="${imagens[1]}" alt="img2">
                    <img id="main-img3-${cardId}" class="main-img ${mainImageIndex === 2 ? 'active' : ''}" src="${imagens[2]}" alt="img3">
                    <img id="main-img4-${cardId}" class="main-img ${mainImageIndex === 3 ? 'active' : ''}" src="${imagens[3]}" alt="img4">
                    <span class="product-details">
                        <h3>Produto1</h3>
                        <p>Detalhes do meu pequeno teste Lorem ipsum dolor sit, amet consectetur adipisicing elit.</p>
                    </span>
                </div>
                <hr class="card-line">
                <div class="change-product">
                    <div class="options-product">
                        <span>Outras opções:</span>
                        <div class="img-options">
                            <img class="option ${mainImageIndex === 0 ? 'active' : ''}" data-target="main-img1-${cardId}" src="${imagens[0]}"
                                alt="imagem de opções" data-title="Produto1" data-description="Detalhes do meu pequeno teste Lorem ipsum dolor sit, amet consectetur adipisicing elit.">
                            <img class="option ${mainImageIndex === 1 ? 'active' : ''}" data-target="main-img2-${cardId}" src="${imagens[1]}"
                                alt="imagem de opções" data-title="Produto2" data-description="Detalhes do meu segundo produto Lorem ipsum dolor sit amet, consectetur adipisicing elit.">
                            <img class="option ${mainImageIndex === 2 ? 'active' : ''}" data-target="main-img3-${cardId}" src="${imagens[2]}"
                                alt="imagem de opções" data-title="Produto3" data-description="Detalhes do meu terceiro produto Lorem ipsum dolor sit amet, consectetur adipisicing elit.">
                            <img class="option ${mainImageIndex === 3 ? 'active' : ''}" data-target="main-img4-${cardId}" src="${imagens[3]}"
                                alt="imagem de opções" data-title="Produto4" data-description="Detalhes do meu terceiro produto Lorem ipsum dolor sit amet, consectetur adipisicing elit.">
                        </div>
                    </div>
                </div>
            `;
            const container = document.querySelector('.product-card-container');
            const buttonContainer = document.getElementById('container-button-prod');
            container.insertBefore(cardTemplate, buttonContainer);
    
            // Adiciona eventos ao novo card
            const newCard = document.getElementById(cardId);
            newCard.querySelectorAll(".img-options .option").forEach(option => {
                option.addEventListener("click", (e) => {
                    let parentCard = option.closest(".product-card");
                    updateMainContent(option, parentCard);
                });
            });
    
            newCard.querySelector('.bxs-trash-alt').addEventListener('click', (e) => {
                let parentCard = e.target.closest('.product-card');
                parentCard.remove();
                updateCardCount();
            });
    
            updateCardCount();
        }
    
        function getImagensTratamento(tratamento) {
            const basePath = "assets/img/produtos/";
            if (tratamento === "Aromaterapia") {
                return [
                    `${basePath}aromaterapia01.jpeg`,
                    `${basePath}aromaterapia02.jpeg`,
                    `${basePath}aromaterapia03.jpeg`,
                    `${basePath}aromaterapia04.jpeg`
                ];
            } else if (tratamento === "Cuidados Pessoais") {
                return [
                    `${basePath}cuidados_pessoais01.jpeg`,
                    `${basePath}cuidados_pessoais02.jpeg`,
                    `${basePath}cuidados_pessoais03.jpeg`,
                    `${basePath}cuidados_pessoais04.jpeg`
                ];
            } else if (tratamento === "Saúde Mental") {
                return [
                    `${basePath}saude_mental01.jpeg`,
                    `${basePath}saude_mental02.jpeg`,
                    `${basePath}saude_mental03.jpeg`,
                    `${basePath}saude_mental04.jpeg`
                ];
            }
            return [
                `${basePath}default1.jpeg`,
                `${basePath}default2.jpeg`,
                `${basePath}default3.jpeg`,
                `${basePath}default4.jpeg`
            ];
        }
    
        function updateMainContent(option, parentCard) {
            // Remove active class from all main images
            parentCard.querySelectorAll(".main-images .main-img").forEach(img => {
                img.classList.remove("active");
            });
            // Add active class to the selected main image
            parentCard.querySelector(`#${option.dataset.target}`).classList.add("active");
    
            // Update product details
            parentCard.querySelector("h3").textContent = option.dataset.title;
            parentCard.querySelector("p").textContent = option.dataset.description;
    
            // Remove active class from all options
            parentCard.querySelectorAll(".img-options .option").forEach(opt => {
                opt.classList.remove("active");
            });
            // Add active class to the selected option
            option.classList.add("active");
        }
    
        function updateCardCount() {
            const cardCount = document.querySelectorAll('.product-card').length;
            let avisoCarrinho = document.querySelectorAll('.aviso-carrinho')

            if (cardCount >= 5) {
                document.getElementById('addProduto').disabled = true;
                avisoCarrinho.forEach(aviso => {
                    aviso.textContent = "Você atingiu o limite de produtos adicionados.";
                });
            } else {
                document.getElementById('addProduto').disabled = false;
                avisoCarrinho.forEach(aviso => {
                    aviso.textContent = `Você pode adicionar até 5 produtos. (${cardCount} de 5)`;
                });
                
            }
            console.log(`Número de cards: ${cardCount} de 5`);
            
        }

        
    
        // Adiciona evento de clique ao botão de adicionar
        document.getElementById('addProduto').addEventListener('click', () => {
            const count = document.querySelectorAll('.product-card').length;
            if (count < 5) {
                createNewCard(`card${count + 1}`);
            } else {
                alert("Você só pode adicionar no máximo 5 produtos.");
                
            }
        });
    </script>
    
</body>

</html>